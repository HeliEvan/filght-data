<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å…¥æ•°æ® - é£è¡Œç»å†å½•å…¥ç³»ç»Ÿ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            writing-mode: horizontal-tb;
            direction: ltr;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            margin-bottom: 30px;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: #e8f0fe;
            border-color: #764ba2;
        }
        
        .upload-area.dragover {
            background: #e8f0fe;
            border-color: #4caf50;
        }
        
        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }
        
        .upload-text {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .format-info {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .format-info h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .format-info ul {
            list-style: none;
            padding-left: 0;
        }
        
        .format-info li {
            color: #856404;
            margin-bottom: 8px;
            padding-left: 25px;
            position: relative;
        }
        
        .format-info li:before {
            content: "â€¢";
            position: absolute;
            left: 10px;
            font-size: 1.5em;
        }
        
        .preview-table {
            margin-top: 30px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e0e0e0;
        }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <h1>ğŸ“¥ å¯¼å…¥æ•°æ®</h1>
        </div>
        
        <div class="format-info">
            <h3>Excel å¯¼å…¥æ ¼å¼è¯´æ˜</h3>
            <ul>
                <li>ç¬¬ä¸€è¡Œå¿…é¡»ä¸ºè¡¨å¤´ï¼ŒåŒ…å«ä»¥ä¸‹åˆ—ï¼ˆé¡ºåºå¯è°ƒæ•´ï¼‰ï¼š</li>
                <li>æ—¥æœŸã€èˆªç©ºå™¨å‹å·ã€èˆªç©ºå™¨ç™»è®°å·ã€èµ·é£ç«™ã€é™è½ç«™ã€å¼€è½¦æ—¶åˆ»ã€å…³è½¦æ—¶åˆ»ã€æ€»æ—¶é—´ã€æœºé•¿ã€å‰¯é©¾é©¶ã€ä»ªè¡¨ã€æœºé•¿è½¬åœºã€å‰¯é©¾é©¶è½¬åœºã€å¤œèˆªã€é£è¡Œç§ç±»ã€ç€é™†æ¬¡æ•°(æ˜¼é—´)ã€ç€é™†æ¬¡æ•°(å¤œé—´)ã€æœºç»„æˆå‘˜ã€æ•‘åŠ©äººæ•°ã€SPICã€å¤‡æ³¨</li>
                <li>æ—¶é—´æ ¼å¼ï¼šHH:MMï¼ˆå¦‚ 01:30ï¼‰</li>
                <li>æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DDã€YYYY/MM/DDã€YYYYå¹´MMæœˆDDæ—¥æˆ–Excelæ—¥æœŸæ ¼å¼</li>
                <li>ä»ªè¡¨å’Œå¤œèˆªï¼šå¡«å†™æ—¶é—´æ ¼å¼ HH:MMï¼ˆå¦‚ 00:30ï¼‰</li>
                <li>å»ºè®®ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶ï¼Œç¡®ä¿æ ¼å¼æ­£ç¡®</li>
            </ul>
            <button class="btn btn-primary" onclick="downloadTemplate()" style="margin-top: 15px;">ğŸ“¥ ä¸‹è½½å¯¼å…¥æ¨¡æ¿</button>
        </div>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“„</div>
            <div class="upload-text">æ‹–æ‹½ Excel æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">é€‰æ‹©æ–‡ä»¶</button>
            <input type="file" id="fileInput" accept=".xlsx,.xls" onchange="handleFileSelect(event)">
        </div>
        
        <div id="preview" class="preview-table" style="display: none;">
            <h3>æ•°æ®é¢„è§ˆï¼ˆå‰5æ¡ï¼‰</h3>
            <table id="previewTable">
                <thead id="previewHead"></thead>
                <tbody id="previewBody"></tbody>
            </table>
            <button class="btn btn-primary" onclick="importData()" style="margin-top: 20px;">ç¡®è®¤å¯¼å…¥</button>
        </div>
        
        <div id="successMessage" class="success-message"></div>
        <div id="errorMessage" class="error-message"></div>
    </div>
    
    <script>
        let parsedData = [];
        
        // æ‹–æ‹½ä¸Šä¼ 
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }
        
        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (jsonData.length === 0) {
                        showError('Excel æ–‡ä»¶ä¸ºç©º');
                        return;
                    }
                    
                    parsedData = jsonData;
                    showPreview(jsonData);
                } catch (error) {
                    showError('æ–‡ä»¶è¯»å–å¤±è´¥: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function showPreview(data) {
            const preview = document.getElementById('preview');
            const previewHead = document.getElementById('previewHead');
            const previewBody = document.getElementById('previewBody');
            
            // æ˜¾ç¤ºè¡¨å¤´
            const headers = Object.keys(data[0]);
            previewHead.innerHTML = '<tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr>';
            
            // æ˜¾ç¤ºå‰5æ¡æ•°æ®
            previewBody.innerHTML = data.slice(0, 5).map(row => {
                return '<tr>' + headers.map(h => `<td>${row[h] || ''}</td>`).join('') + '</tr>';
            }).join('');
            
            preview.style.display = 'block';
            hideMessages();
        }
        
        function importData() {
            if (parsedData.length === 0) {
                showError('æ²¡æœ‰å¯å¯¼å…¥çš„æ•°æ®');
                return;
            }
            
            const existingRecords = JSON.parse(localStorage.getItem('flightRecords') || '[]');
            let importedCount = 0;
            let errorCount = 0;
            
            parsedData.forEach((row, index) => {
                try {
                    // æ˜ å°„Excelåˆ—åˆ°ç³»ç»Ÿå­—æ®µï¼ˆæŒ‰ç…§æ–°é¡ºåºï¼‰
                    const record = {
                        id: Date.now() + index,
                        // 1. æ—¥æœŸ
                        date: formatDate(row['æ—¥æœŸ'] || row['date']),
                        // 2. èˆªç©ºå™¨å‹å·
                        aircraftType: row['èˆªç©ºå™¨å‹å·'] || row['æœºå‹'] || row['aircraftType'] || '',
                        // 3. èˆªç©ºå™¨ç™»è®°å·
                        aircraftReg: row['èˆªç©ºå™¨ç™»è®°å·'] || row['ç™»è®°å·'] || row['aircraftReg'] || '',
                        // 4. èµ·é£ç«™
                        departure: row['èµ·é£ç«™'] || row['departure'] || '',
                        // 5. é™è½ç«™
                        arrival: row['é™è½ç«™'] || row['arrival'] || '',
                        // 6. å¼€è½¦æ—¶åˆ»
                        engineStart: row['å¼€è½¦æ—¶åˆ»'] || row['engineStart'] || '',
                        // 7. å…³è½¦æ—¶åˆ»
                        engineStop: row['å…³è½¦æ—¶åˆ»'] || row['engineStop'] || '',
                        // 8. æ€»æ—¶é—´
                        totalTime: formatTime(row['æ€»æ—¶é—´'] || row['totalTime']),
                        // 9. æœºé•¿
                        captain: row['æœºé•¿'] || row['captain'] || '',
                        // 10. å‰¯é©¾é©¶
                        copilot: row['å‰¯é©¾é©¶'] || row['copilot'] || '',
                        // 11. ä»ªè¡¨ï¼ˆæ—¶é—´æ ¼å¼ï¼‰
                        instrument: formatTime(row['ä»ªè¡¨'] || row['instrument'] || '00:00'),
                        // 12. æœºé•¿è½¬åœº
                        captainCrossCountry: formatTime(row['æœºé•¿è½¬åœº'] || row['captainCrossCountry'] || '00:00'),
                        // 13. å‰¯é©¾é©¶è½¬åœº
                        copilotCrossCountry: formatTime(row['å‰¯é©¾é©¶è½¬åœº'] || row['copilotCrossCountry'] || '00:00'),
                        // 14. å¤œèˆªï¼ˆæ—¶é—´æ ¼å¼ï¼‰
                        nightFlight: formatTime(row['å¤œèˆª'] || row['nightFlight'] || '00:00'),
                        // 15. é£è¡Œç§ç±»
                        flightType: row['é£è¡Œç§ç±»'] || row['flightType'] || 'å…¶ä»–',
                        // 16. ç€é™†æ¬¡æ•°(æ˜¼é—´)
                        landingsDay: parseInt(row['ç€é™†æ¬¡æ•°(æ˜¼é—´)'] || row['ç€é™†æ¬¡æ•°(æ˜¼)'] || row['landingsDay'] || 0),
                        // 17. ç€é™†æ¬¡æ•°(å¤œé—´)
                        landingsNight: parseInt(row['ç€é™†æ¬¡æ•°(å¤œé—´)'] || row['ç€é™†æ¬¡æ•°(å¤œ)'] || row['landingsNight'] || 0),
                        // 18. æœºç»„æˆå‘˜
                        crewMembers: row['æœºç»„æˆå‘˜'] || row['crewMembers'] || '',
                        // 19. æ•‘åŠ©äººæ•°
                        rescued: parseInt(row['æ•‘åŠ©äººæ•°'] || row['rescued'] || 0),
                        // 20. SPIC
                        spic: formatTime(row['SPIC'] || row['spic'] || '00:00'),
                        // 21. å¤‡æ³¨
                        remarks: row['å¤‡æ³¨'] || row['remarks'] || ''
                    };
                    
                    // è®¡ç®—æœºé•¿æ—¶é—´å’Œå‰¯é©¾é©¶æ—¶é—´ï¼ˆç”¨äºå†…éƒ¨å­˜å‚¨ï¼‰
                    record.captainTime = record.captain && record.totalTime ? record.totalTime : '00:00';
                    record.copilotTime = record.copilot && record.totalTime ? record.totalTime : '00:00';
                    
                    // æ™ºèƒ½è”åŠ¨å¤„ç†
                    if (record.captain && record.totalTime) {
                        record.captainTime = record.totalTime;
                        if (record.flightType === 'è½¬åœº' || record.flightType === 'æµ·ä¸Šè®­ç»ƒ' || record.flightType === 'æ•‘åŠ©') {
                            record.captainCrossCountry = record.totalTime;
                        }
                    }
                    
                    if (record.copilot && record.totalTime) {
                        record.copilotTime = record.totalTime;
                        // å¦‚æœSPICä¸ºç©ºæˆ–00:00ï¼Œä¸”æœ‰å‰¯é©¾é©¶ï¼Œåˆ™SPICç­‰äºæ€»æ—¶é—´
                        if (!record.spic || record.spic === '00:00') {
                            record.spic = record.totalTime;
                        }
                        if (record.flightType === 'è½¬åœº' || record.flightType === 'æµ·ä¸Šè®­ç»ƒ' || record.flightType === 'æ•‘åŠ©') {
                            record.copilotCrossCountry = record.totalTime;
                        }
                    }
                    
                    existingRecords.push(record);
                    importedCount++;
                } catch (error) {
                    errorCount++;
                    console.error(`ç¬¬ ${index + 1} è¡Œå¯¼å…¥å¤±è´¥:`, error);
                }
            });
            
            localStorage.setItem('flightRecords', JSON.stringify(existingRecords));
            
            if (errorCount > 0) {
                showSuccess(`æˆåŠŸå¯¼å…¥ ${importedCount} æ¡è®°å½•ï¼Œ${errorCount} æ¡å¤±è´¥`);
            } else {
                showSuccess(`æˆåŠŸå¯¼å…¥ ${importedCount} æ¡è®°å½•ï¼`);
            }
            
            // æ¸…ç©ºé¢„è§ˆ
            document.getElementById('preview').style.display = 'none';
            parsedData = [];
        }
        
        function formatDate(date) {
            if (!date) return new Date().toISOString().split('T')[0];
            
            // å¦‚æœå·²ç»æ˜¯Dateå¯¹è±¡
            if (date instanceof Date) {
                // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆæ—¥æœŸ
                if (isNaN(date.getTime())) {
                    return new Date().toISOString().split('T')[0];
                }
                return date.toISOString().split('T')[0];
            }
            
            // å¦‚æœæ˜¯æ•°å­—ï¼ˆExcelæ—¥æœŸåºåˆ—å·ï¼‰
            if (typeof date === 'number') {
                // Excelæ—¥æœŸä»1900-01-01å¼€å§‹ï¼Œä½†Excelé”™è¯¯åœ°è®¤ä¸º1900æ˜¯é—°å¹´
                const excelEpoch = new Date(1899, 11, 30); // 1900-01-00çš„å‰ä¸€å¤©
                const resultDate = new Date(excelEpoch.getTime() + date * 24 * 60 * 60 * 1000);
                return resultDate.toISOString().split('T')[0];
            }
            
            // å¦‚æœæ˜¯å­—ç¬¦ä¸²
            if (typeof date === 'string') {
                // å¤„ç†ä¸­æ–‡æ—¥æœŸæ ¼å¼ï¼š2024å¹´1æœˆ1æ—¥
                if (date.includes('å¹´') && date.includes('æœˆ') && date.includes('æ—¥')) {
                    const match = date.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);
                    if (match) {
                        const year = match[1];
                        const month = String(match[2]).padStart(2, '0');
                        const day = String(match[3]).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    }
                }
                
                // å¤„ç†æ–œæ åˆ†éš”çš„æ—¥æœŸï¼š2024/1/1 æˆ– 1/1/2024
                if (date.includes('/')) {
                    const parts = date.split('/');
                    if (parts.length === 3) {
                        if (parts[0].length === 4) {
                            // YYYY/MM/DD
                            return `${parts[0]}-${String(parts[1]).padStart(2, '0')}-${String(parts[2]).padStart(2, '0')}`;
                        } else {
                            // MM/DD/YYYY
                            return `${parts[2]}-${String(parts[0]).padStart(2, '0')}-${String(parts[1]).padStart(2, '0')}`;
                        }
                    }
                }
                
                // å¤„ç†æ¨ªçº¿åˆ†éš”çš„æ—¥æœŸï¼š2024-1-1 æˆ– 2024-01-01
                if (date.includes('-')) {
                    const parts = date.split('-');
                    if (parts.length === 3) {
                        if (parts[0].length === 4) {
                            // YYYY-MM-DD
                            return `${parts[0]}-${String(parts[1]).padStart(2, '0')}-${String(parts[2]).padStart(2, '0')}`;
                        } else {
                            // MM-DD-YYYY
                            return `${parts[2]}-${String(parts[0]).padStart(2, '0')}-${String(parts[1]).padStart(2, '0')}`;
                        }
                    }
                }
                
                // å°è¯•ç›´æ¥è§£æ
                const parsedDate = new Date(date);
                if (!isNaN(parsedDate.getTime())) {
                    return parsedDate.toISOString().split('T')[0];
                }
            }
            
            return new Date().toISOString().split('T')[0];
        }
        
        function formatTime(time) {
            if (!time) return '00:00';
            if (typeof time === 'number') {
                // å¦‚æœæ˜¯æ•°å­—ï¼Œå¯èƒ½æ˜¯åˆ†é’Ÿæ•°
                const h = Math.floor(time / 60);
                const m = time % 60;
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
            }
            if (typeof time === 'string') {
                // å¤„ç†æ—¶é—´å­—ç¬¦ä¸²
                if (time.includes(':')) {
                    return time;
                }
            }
            return '00:00';
        }
        
        function parseBoolean(value) {
            if (!value) return false;
            if (typeof value === 'boolean') return value;
            if (typeof value === 'string') {
                return value.toLowerCase() === 'æ˜¯' || value.toLowerCase() === 'yes' || value === '1';
            }
            return false;
        }
        
        function showSuccess(message) {
            const msg = document.getElementById('successMessage');
            msg.textContent = message;
            msg.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
        }
        
        function showError(message) {
            const msg = document.getElementById('errorMessage');
            msg.textContent = message;
            msg.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
        }
        
        function hideMessages() {
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }
        
        // ä¸‹è½½å¯¼å…¥æ¨¡æ¿
        function downloadTemplate() {
            const headers = [
                'æ—¥æœŸ',
                'èˆªç©ºå™¨å‹å·',
                'èˆªç©ºå™¨ç™»è®°å·',
                'èµ·é£ç«™',
                'é™è½ç«™',
                'å¼€è½¦æ—¶åˆ»',
                'å…³è½¦æ—¶åˆ»',
                'æ€»æ—¶é—´',
                'æœºé•¿',
                'å‰¯é©¾é©¶',
                'ä»ªè¡¨',
                'æœºé•¿è½¬åœº',
                'å‰¯é©¾é©¶è½¬åœº',
                'å¤œèˆª',
                'é£è¡Œç§ç±»',
                'ç€é™†æ¬¡æ•°(æ˜¼é—´)',
                'ç€é™†æ¬¡æ•°(å¤œé—´)',
                'æœºç»„æˆå‘˜',
                'æ•‘åŠ©äººæ•°',
                'SPIC',
                'å¤‡æ³¨'
            ];
            
            // åˆ›å»ºç¤ºä¾‹æ•°æ®
            const exampleData = [
                headers,
                [
                    '2024-01-15',
                    'S76C+',
                    'B-XXXX',
                    'åŒ—äº¬',
                    'ä¸Šæµ·',
                    '08:00',
                    '10:30',
                    '02:30',
                    'å¼ ä¸‰',
                    'æå››',
                    '00:30',
                    '02:30',
                    '02:30',
                    '01:00',
                    'è®­ç»ƒ',
                    '2',
                    '0',
                    'ç‹äº”,èµµå…­',
                    '0',
                    '02:30',
                    'æ­£å¸¸è®­ç»ƒ'
                ]
            ];
            
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(exampleData);
            
            // è®¾ç½®åˆ—å®½
            const colWidths = [
                { wch: 12 }, // æ—¥æœŸ
                { wch: 12 }, // èˆªç©ºå™¨å‹å·
                { wch: 15 }, // èˆªç©ºå™¨ç™»è®°å·
                { wch: 10 }, // èµ·é£ç«™
                { wch: 10 }, // é™è½ç«™
                { wch: 12 }, // å¼€è½¦æ—¶åˆ»
                { wch: 12 }, // å…³è½¦æ—¶åˆ»
                { wch: 10 }, // æ€»æ—¶é—´
                { wch: 10 }, // æœºé•¿
                { wch: 10 }, // å‰¯é©¾é©¶
                { wch: 10 }, // ä»ªè¡¨
                { wch: 12 }, // æœºé•¿è½¬åœº
                { wch: 15 }, // å‰¯é©¾é©¶è½¬åœº
                { wch: 10 }, // å¤œèˆª
                { wch: 12 }, // é£è¡Œç§ç±»
                { wch: 15 }, // ç€é™†æ¬¡æ•°(æ˜¼é—´)
                { wch: 15 }, // ç€é™†æ¬¡æ•°(å¤œé—´)
                { wch: 15 }, // æœºç»„æˆå‘˜
                { wch: 12 }, // æ•‘åŠ©äººæ•°
                { wch: 10 }, // SPIC
                { wch: 20 }  // å¤‡æ³¨
            ];
            ws['!cols'] = colWidths;
            
            // è®¾ç½®ç¬¬ä¸€è¡Œä¸ºç²—ä½“
            const range = XLSX.utils.decode_range(ws['!ref']);
            for (let col = range.s.c; col <= range.e.c; col++) {
                const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                if (!ws[cellAddress]) continue;
                ws[cellAddress].s = {
                    font: { bold: true },
                    alignment: { horizontal: 'center', vertical: 'center' },
                    fill: { fgColor: { rgb: 'E0E0E0' } }
                };
            }
            
            // å°†å·¥ä½œè¡¨æ·»åŠ åˆ°å·¥ä½œç°¿
            XLSX.utils.book_append_sheet(wb, ws, 'é£è¡Œè®°å½•');
            
            // ç”Ÿæˆæ–‡ä»¶åï¼ˆåŒ…å«å½“å‰æ—¥æœŸï¼‰
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `é£è¡Œè®°å½•å¯¼å…¥æ¨¡æ¿_${dateStr}.xlsx`;
            
            // ä¸‹è½½æ–‡ä»¶
            XLSX.writeFile(wb, fileName);
        }
    </script>
</body>
</html>
