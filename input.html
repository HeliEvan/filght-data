<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½•å…¥é£è¡Œè®°å½• - é£è¡Œç»å†å½•å…¥ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            writing-mode: horizontal-tb;
            direction: ltr;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #333;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
            align-items: start;
        }
        
        @media (max-width: 1200px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            min-height: 80px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
            height: 24px;
            display: flex;
            align-items: center;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
            width: 100%;
            box-sizing: border-box;
            height: 44px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
            height: auto;
        }
        
        .time-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .time-group label {
            height: auto;
            margin-bottom: 5px;
        }
        
        .time-group input {
            height: 44px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        button {
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .auto-calc {
            background: #e8f5e9;
            padding: 8px 10px;
            border-radius: 8px;
            margin-top: 5px;
            font-size: 0.9em;
            color: #2e7d32;
            min-height: 32px;
            display: flex;
            align-items: center;
        }
        
        .info-tip {
            background: #fff3cd;
            padding: 8px 10px;
            border-radius: 8px;
            margin-top: 5px;
            font-size: 0.85em;
            color: #856404;
            min-height: 32px;
            display: flex;
            align-items: center;
        }
        
        input[readonly] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <h1>ğŸ“ å½•å…¥é£è¡Œè®°å½•</h1>
        </div>
        
        <form id="flightForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="date">æ—¥æœŸ *</label>
                    <input type="date" id="date" name="date" required>
                </div>
                
                <div class="form-group">
                    <label for="aircraftType">èˆªç©ºå™¨å‹å· *</label>
                    <select id="aircraftType" name="aircraftType" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="S76C+">S76C+</option>
                        <option value="S76C++">S76C++</option>
                        <option value="S76D">S76D</option>
                        <option value="G2">G2</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="aircraftReg">èˆªç©ºå™¨ç™»è®°å· *</label>
                    <input type="text" id="aircraftReg" name="aircraftReg" required>
                </div>
                
                <div class="form-group">
                    <label for="departure">èµ·é£ç«™ *</label>
                    <input type="text" id="departure" name="departure" required>
                </div>
                
                <div class="form-group">
                    <label for="arrival">é™è½ç«™ *</label>
                    <input type="text" id="arrival" name="arrival" required>
                </div>
                
                <div class="form-group">
                    <label>æ—¶é—´</label>
                    <div class="time-group">
                        <div>
                            <label for="engineStart" style="font-size: 0.85em; color: #666;">å¼€è½¦æ—¶åˆ»</label>
                            <input type="text" id="engineStart" name="engineStart" placeholder="HH:MM" maxlength="5" pattern="[0-9]{2}:[0-9]{2}">
                        </div>
                        <div>
                            <label for="engineStop" style="font-size: 0.85em; color: #666;">å…³è½¦æ—¶åˆ»</label>
                            <input type="text" id="engineStop" name="engineStop" placeholder="HH:MM" maxlength="5" pattern="[0-9]{2}:[0-9]{2}">
                        </div>
                    </div>
                    <div class="auto-calc" id="timeCalc" style="display: none;">
                        è‡ªåŠ¨è®¡ç®—æ€»æ—¶é—´: <span id="calcTime">00:00</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="totalTime">æ€»æ—¶é—´ (HH:MM) *</label>
                    <input type="text" id="totalTime" name="totalTime" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00" required readonly style="background-color: #f5f5f5;">
                    <div class="info-tip">æ ¹æ®å¼€è½¦/å…³è½¦æ—¶åˆ»è‡ªåŠ¨è®¡ç®—</div>
                </div>
                
                <div class="form-group">
                    <label for="captain">æœºé•¿</label>
                    <input type="text" id="captain" name="captain" placeholder="è¾“å…¥æœºé•¿å§“å">
                </div>
                
                <div class="form-group">
                    <label for="captainTime">æœºé•¿æ—¶é—´ (HH:MM)</label>
                    <input type="text" id="captainTime" name="captainTime" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group">
                    <label for="captainCrossCountry">æœºé•¿è½¬åœº (HH:MM)</label>
                    <input type="text" id="captainCrossCountry" name="captainCrossCountry" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group">
                    <label for="copilot">å‰¯é©¾é©¶</label>
                    <input type="text" id="copilot" name="copilot" placeholder="è¾“å…¥å‰¯é©¾é©¶å§“å">
                </div>
                
                <div class="form-group">
                    <label for="copilotTime">å‰¯é©¾é©¶æ—¶é—´ (HH:MM)</label>
                    <input type="text" id="copilotTime" name="copilotTime" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group">
                    <label for="copilotCrossCountry">å‰¯é©¾é©¶è½¬åœº (HH:MM)</label>
                    <input type="text" id="copilotCrossCountry" name="copilotCrossCountry" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group">
                    <label for="spic">SPIC (HH:MM)</label>
                    <input type="text" id="spic" name="spic" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group">
                    <label for="instructor">å¸¦é£ (HH:MM)</label>
                    <input type="text" id="instructor" name="instructor" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group">
                    <label for="instructorCrossCountry">å¸¦é£è½¬åœº (HH:MM)</label>
                    <input type="text" id="instructorCrossCountry" name="instructorCrossCountry" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group">
                    <label for="flightType">é£è¡Œç§ç±» *</label>
                    <select id="flightType" name="flightType" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="è®­ç»ƒ">è®­ç»ƒ</option>
                        <option value="è½¬åœº">è½¬åœº</option>
                        <option value="æµ·ä¸Šè®­ç»ƒ">æµ·ä¸Šè®­ç»ƒ</option>
                        <option value="æ•‘åŠ©">æ•‘åŠ©</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ç€é™†æ¬¡æ•°</label>
                    <div class="time-group">
                        <div>
                            <label for="landingsDay" style="font-size: 0.85em; color: #666;">æ˜¼é—´</label>
                            <input type="number" id="landingsDay" name="landingsDay" min="0" value="0">
                        </div>
                        <div>
                            <label for="landingsNight" style="font-size: 0.85em; color: #666;">å¤œé—´</label>
                            <input type="number" id="landingsNight" name="landingsNight" min="0" value="0">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="crewMembers">æœºç»„æˆå‘˜</label>
                    <input type="text" id="crewMembers" name="crewMembers" placeholder="å¤šä¸ªæˆå‘˜ç”¨é€—å·åˆ†éš”">
                </div>
                
                <div class="form-group">
                    <label for="rescued">æ•‘åŠ©äººæ•°</label>
                    <input type="number" id="rescued" name="rescued" min="0" value="0">
                </div>
                
                <div class="form-group">
                    <label for="instrument">ä»ªè¡¨æ—¶é—´ (HH:MM)</label>
                    <input type="text" id="instrument" name="instrument" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group">
                    <label for="nightFlight">å¤œèˆªæ—¶é—´ (HH:MM)</label>
                    <input type="text" id="nightFlight" name="nightFlight" pattern="[0-9]{2}:[0-9]{2}" placeholder="00:00">
                </div>
                
                <div class="form-group full-width">
                    <label for="remarks">å¤‡æ³¨</label>
                    <textarea id="remarks" name="remarks" placeholder="å…¶ä»–éœ€è¦è®°å½•çš„ä¿¡æ¯"></textarea>
                </div>
            </div>
            
            <div class="button-group">
                <button type="submit" class="btn-primary">ä¿å­˜è®°å½•</button>
                <button type="reset" class="btn-secondary">é‡ç½®è¡¨å•</button>
            </div>
        </form>
    </div>
    
    <script>
        // æ—¶é—´è®¡ç®—å‡½æ•°
        function calculateTime() {
            const start = document.getElementById('engineStart').value;
            const stop = document.getElementById('engineStop').value;
            
            if (start && stop && /^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(start) && /^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(stop)) {
                const [startH, startM] = start.split(':').map(Number);
                const [stopH, stopM] = stop.split(':').map(Number);
                
                let startMinutes = startH * 60 + startM;
                let stopMinutes = stopH * 60 + stopM;
                
                // å¤„ç†è·¨å¤©æƒ…å†µ
                if (stopMinutes < startMinutes) {
                    stopMinutes += 24 * 60; // åŠ ä¸€å¤©
                }
                
                const diffMinutes = stopMinutes - startMinutes;
                const hours = Math.floor(diffMinutes / 60);
                const minutes = diffMinutes % 60;
                
                const timeStr = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                document.getElementById('calcTime').textContent = timeStr;
                document.getElementById('timeCalc').style.display = 'block';
                
                // è‡ªåŠ¨å¡«å……æ€»æ—¶é—´ï¼ˆå§‹ç»ˆæ›´æ–°ï¼‰
                document.getElementById('totalTime').value = timeStr;
                updateLinkedTimes();
            } else {
                document.getElementById('timeCalc').style.display = 'none';
            }
        }
        
        // æ™ºèƒ½è”åŠ¨æ›´æ–°
        function updateLinkedTimes() {
            const totalTime = document.getElementById('totalTime').value;
            const captain = document.getElementById('captain').value.trim();
            const copilot = document.getElementById('copilot').value.trim();
            const flightType = document.getElementById('flightType').value;
            const captainTime = document.getElementById('captainTime').value;
            const copilotTime = document.getElementById('copilotTime').value;
            
            // è§„åˆ™1: å½•å…¥æœºé•¿å§“å â†’ æœºé•¿æ—¶é—´ = æ€»æ—¶é—´
            if (captain && totalTime) {
                document.getElementById('captainTime').value = totalTime;
                
                // è§„åˆ™3: é€‰æ‹©ã€Œè½¬åœºã€/ã€Œæµ·ä¸Šè®­ç»ƒã€/ã€Œæ•‘åŠ©ã€â†’ æœºé•¿è½¬åœº = æœºé•¿æ—¶é—´
                if (flightType === 'è½¬åœº' || flightType === 'æµ·ä¸Šè®­ç»ƒ' || flightType === 'æ•‘åŠ©') {
                    document.getElementById('captainCrossCountry').value = totalTime;
                } else if (!flightType || flightType === 'è®­ç»ƒ' || flightType === 'å…¶ä»–') {
                    // å¦‚æœä¸æ˜¯è½¬åœºç±»å‹ï¼Œæ¸…ç©ºè½¬åœºæ—¶é—´
                    if (!document.getElementById('captainCrossCountry').value) {
                        document.getElementById('captainCrossCountry').value = '00:00';
                    }
                }
            } else if (!captain) {
                // å¦‚æœæ¸…ç©ºæœºé•¿å§“åï¼Œæ¸…ç©ºæœºé•¿æ—¶é—´
                document.getElementById('captainTime').value = '';
                document.getElementById('captainCrossCountry').value = '';
            }
            
            // è§„åˆ™2: å½•å…¥å‰¯é©¾é©¶å§“å â†’ å‰¯é©¾é©¶æ—¶é—´ = æ€»æ—¶é—´ = SPICæ—¶é—´
            if (copilot && totalTime) {
                document.getElementById('copilotTime').value = totalTime;
                document.getElementById('spic').value = totalTime;
                
                // è§„åˆ™3: é€‰æ‹©ã€Œè½¬åœºã€/ã€Œæµ·ä¸Šè®­ç»ƒã€/ã€Œæ•‘åŠ©ã€â†’ å‰¯é©¾é©¶è½¬åœº = å‰¯é©¾é©¶æ—¶é—´
                if (flightType === 'è½¬åœº' || flightType === 'æµ·ä¸Šè®­ç»ƒ' || flightType === 'æ•‘åŠ©') {
                    document.getElementById('copilotCrossCountry').value = totalTime;
                } else if (!flightType || flightType === 'è®­ç»ƒ' || flightType === 'å…¶ä»–') {
                    // å¦‚æœä¸æ˜¯è½¬åœºç±»å‹ï¼Œæ¸…ç©ºè½¬åœºæ—¶é—´
                    if (!document.getElementById('copilotCrossCountry').value) {
                        document.getElementById('copilotCrossCountry').value = '00:00';
                    }
                }
            } else if (!copilot) {
                // å¦‚æœæ¸…ç©ºå‰¯é©¾é©¶å§“åï¼Œæ¸…ç©ºå‰¯é©¾é©¶æ—¶é—´å’ŒSPIC
                document.getElementById('copilotTime').value = '';
                document.getElementById('copilotCrossCountry').value = '';
                document.getElementById('spic').value = '';
            }
        }
        
        // æ—¶é—´è¾“å…¥æ¡†æ ¼å¼åŒ–ï¼ˆä¸è‡ªåŠ¨åˆ‡æ¢ç„¦ç‚¹ï¼‰
        function setupTimeInputFormat() {
            const timeInputs = ['engineStart', 'engineStop', 'instrument', 'nightFlight'];
            
            timeInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (!input) return;
                
                // åªå…è®¸è¾“å…¥æ•°å­—å’Œå†’å·
                input.addEventListener('keypress', function(e) {
                    const char = String.fromCharCode(e.which);
                    if (!/[0-9]/.test(char) && char !== ':') {
                        e.preventDefault();
                    }
                });
                
                // å¤„ç†è¾“å…¥ï¼Œè‡ªåŠ¨æ·»åŠ å†’å·
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9:]/g, ''); // åªä¿ç•™æ•°å­—å’Œå†’å·
                    
                    // å¦‚æœè¾“å…¥äº†2ä½æ•°å­—ä¸”æ²¡æœ‰å†’å·ï¼Œè‡ªåŠ¨æ·»åŠ å†’å·
                    if (value.length === 2 && !value.includes(':')) {
                        value = value + ':';
                        e.target.value = value;
                        // ç§»åŠ¨å…‰æ ‡åˆ°åˆ†é’Ÿä½ç½®
                        setTimeout(() => {
                            e.target.setSelectionRange(3, 5);
                        }, 0);
                    }
                    // å¦‚æœå·²ç»æœ‰å†’å·ï¼Œé™åˆ¶æ€»é•¿åº¦ä¸º5ï¼ˆHH:MMï¼‰
                    else if (value.includes(':')) {
                        const parts = value.split(':');
                        if (parts[0].length > 2) {
                            parts[0] = parts[0].substring(0, 2);
                        }
                        if (parts[1] && parts[1].length > 2) {
                            parts[1] = parts[1].substring(0, 2);
                        }
                        value = parts.join(':');
                        e.target.value = value;
                    }
                    // é™åˆ¶å°æ—¶éƒ¨åˆ†æœ€å¤š2ä½
                    else if (value.length > 2) {
                        value = value.substring(0, 2) + ':';
                        e.target.value = value;
                        setTimeout(() => {
                            e.target.setSelectionRange(3, 5);
                        }, 0);
                    }
                    
                    // å¦‚æœæ˜¯å¼€è½¦æˆ–å…³è½¦æ—¶åˆ»ï¼Œè‡ªåŠ¨è®¡ç®—æ€»æ—¶é—´
                    if (inputId === 'engineStart' || inputId === 'engineStop') {
                        calculateTime();
                    }
                });
                
                // å¤„ç†ç²˜è´´
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const pasted = (e.clipboardData || window.clipboardData).getData('text');
                    const cleaned = pasted.replace(/[^0-9:]/g, '');
                    if (cleaned.length >= 2) {
                        let formatted = cleaned.substring(0, 2);
                        if (cleaned.length > 2) {
                            formatted += ':' + cleaned.substring(2, 4);
                        }
                        e.target.value = formatted;
                    }
                    if (inputId === 'engineStart' || inputId === 'engineStop') {
                        calculateTime();
                    }
                });
                
                // éªŒè¯æ ¼å¼
                input.addEventListener('blur', function(e) {
                    const value = e.target.value;
                    if (value && !/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(value)) {
                        // å¦‚æœæ ¼å¼ä¸æ­£ç¡®ï¼Œå°è¯•ä¿®å¤
                        const parts = value.split(':');
                        if (parts.length === 2) {
                            const h = parts[0].padStart(2, '0').substring(0, 2);
                            const m = parts[1].padStart(2, '0').substring(0, 2);
                            const hour = Math.min(23, parseInt(h) || 0);
                            const minute = Math.min(59, parseInt(m) || 0);
                            e.target.value = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                        }
                    }
                    // å¦‚æœæ˜¯å¼€è½¦æˆ–å…³è½¦æ—¶åˆ»ï¼Œè®¡ç®—æ€»æ—¶é—´
                    if (inputId === 'engineStart' || inputId === 'engineStop') {
                        calculateTime();
                    }
                });
            });
        }
        
        // åŠ è½½ç¼–è¾‘è®°å½•
        function loadEditRecord() {
            const editRecordId = sessionStorage.getItem('editRecordId');
            if (!editRecordId) return;
            
            const records = JSON.parse(localStorage.getItem('flightRecords') || '[]');
            const record = records.find(r => r.id == editRecordId);
            if (!record) {
                sessionStorage.removeItem('editRecordId');
                return;
            }
            
            // å¡«å……è¡¨å•
            document.getElementById('date').value = record.date || '';
            document.getElementById('aircraftType').value = record.aircraftType || '';
            document.getElementById('aircraftReg').value = record.aircraftReg || '';
            document.getElementById('departure').value = record.departure || '';
            document.getElementById('arrival').value = record.arrival || '';
            document.getElementById('engineStart').value = record.engineStart || '';
            document.getElementById('engineStop').value = record.engineStop || '';
            document.getElementById('totalTime').value = record.totalTime || '';
            document.getElementById('captain').value = record.captain || '';
            document.getElementById('captainTime').value = record.captainTime || '';
            document.getElementById('captainCrossCountry').value = record.captainCrossCountry || '';
            document.getElementById('copilot').value = record.copilot || '';
            document.getElementById('copilotTime').value = record.copilotTime || '';
            document.getElementById('copilotCrossCountry').value = record.copilotCrossCountry || '';
            document.getElementById('spic').value = record.spic || '';
            document.getElementById('instructor').value = record.instructor || '';
            document.getElementById('instructorCrossCountry').value = record.instructorCrossCountry || '';
            document.getElementById('instrument').value = record.instrument || '';
            document.getElementById('nightFlight').value = record.nightFlight || '';
            document.getElementById('flightType').value = record.flightType || '';
            document.getElementById('landingsDay').value = record.landingsDay || 0;
            document.getElementById('landingsNight').value = record.landingsNight || 0;
            document.getElementById('crewMembers').value = record.crewMembers || '';
            document.getElementById('rescued').value = record.rescued || 0;
            document.getElementById('remarks').value = record.remarks || '';
            
            // æ›´æ–°æ ‡é¢˜
            const header = document.querySelector('.header h1');
            if (header) {
                header.textContent = 'âœï¸ ä¿®æ”¹é£è¡Œè®°å½•';
            }
        }
        
        // äº‹ä»¶ç›‘å¬
        setupTimeInputFormat();
        document.getElementById('engineStart').addEventListener('input', calculateTime);
        document.getElementById('engineStop').addEventListener('input', calculateTime);
        document.getElementById('totalTime').addEventListener('input', updateLinkedTimes);
        document.getElementById('captain').addEventListener('input', updateLinkedTimes);
        document.getElementById('copilot').addEventListener('input', updateLinkedTimes);
        document.getElementById('flightType').addEventListener('change', updateLinkedTimes);
        
        // åŠ è½½ç¼–è¾‘è®°å½•
        loadEditRecord();
        
        // è¡¨å•æäº¤
        document.getElementById('flightForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editRecordId = sessionStorage.getItem('editRecordId');
            const formData = new FormData(e.target);
            const record = {
                id: editRecordId ? parseInt(editRecordId) : Date.now(),
                date: formData.get('date'),
                aircraftType: formData.get('aircraftType'),
                aircraftReg: formData.get('aircraftReg'),
                departure: formData.get('departure'),
                arrival: formData.get('arrival'),
                engineStart: formData.get('engineStart'),
                engineStop: formData.get('engineStop'),
                totalTime: formData.get('totalTime'),
                captain: formData.get('captain'),
                captainTime: formData.get('captainTime') || '00:00',
                captainCrossCountry: formData.get('captainCrossCountry') || '00:00',
                copilot: formData.get('copilot'),
                copilotTime: formData.get('copilotTime') || '00:00',
                copilotCrossCountry: formData.get('copilotCrossCountry') || '00:00',
                spic: formData.get('spic') || '00:00',
                instructor: formData.get('instructor') || '00:00',
                instructorCrossCountry: formData.get('instructorCrossCountry') || '00:00',
                instrument: formData.get('instrument') || '00:00',
                nightFlight: formData.get('nightFlight') || '00:00',
                flightType: formData.get('flightType'),
                landingsDay: parseInt(formData.get('landingsDay')) || 0,
                landingsNight: parseInt(formData.get('landingsNight')) || 0,
                crewMembers: formData.get('crewMembers'),
                rescued: parseInt(formData.get('rescued')) || 0,
                remarks: formData.get('remarks')
            };
            
            // ä¿å­˜åˆ°localStorage
            const records = JSON.parse(localStorage.getItem('flightRecords') || '[]');
            if (editRecordId) {
                // ç¼–è¾‘æ¨¡å¼ï¼šæ›´æ–°è®°å½•
                const index = records.findIndex(r => r.id == editRecordId);
                if (index !== -1) {
                    records[index] = record;
                }
                sessionStorage.removeItem('editRecordId');
                alert('é£è¡Œè®°å½•ä¿®æ”¹æˆåŠŸï¼');
                // è·³è½¬å›è®°å½•é¡µé¢
                window.location.href = 'records.html';
            } else {
                // æ–°å¢æ¨¡å¼ï¼šæ·»åŠ è®°å½•
                records.push(record);
                alert('é£è¡Œè®°å½•ä¿å­˜æˆåŠŸï¼');
                e.target.reset();
            }
            localStorage.setItem('flightRecords', JSON.stringify(records));
        });
    </script>
</body>
</html>
